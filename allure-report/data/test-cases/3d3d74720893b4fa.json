{"uid":"3d3d74720893b4fa","name":"test_registration_new_lkp[via_link]","fullName":"tests.test_registration#test_registration_new_lkp","historyId":"3c90bf6b153f19dd8b4ca046709cbb0a","time":{"start":1741546577260,"stop":1741546648399,"duration":71139},"description":"Тест регистрации личного кабинета Перевозчика: регистрация - По ссылке Экс, тлф. - 98+get_timestamp_eight_signs, инн - Рандом, лицо - Юридическое, почта - Etimestamp@mail.ru, пользователь - Регресс ПВ, после создания заходим в ЛК и проверяем ИНН, далее заходим в ЛК Экс и принимаем ПВ в контур Экс.,","descriptionHtml":"<p>Тест регистрации личного кабинета Перевозчика: регистрация - По ссылке Экс, тлф. - 98+get_timestamp_eight_signs, инн - Рандом, лицо - Юридическое, почта - Etimestamp@mail.ru, пользователь - Регресс ПВ, после создания заходим в ЛК и проверяем ИНН, далее заходим в ЛК Экс и принимаем ПВ в контур Экс.,</p>\n","status":"broken","statusMessage":"ValueError: Код подтверждения для номера +79809185617 не найден после 12 попыток.","statusTrace":"base_fixture = (<base.base_class.Base object at 0x000001AC73222060>, <pages.login_page.Login object at 0x000001AC73222420>), domain = 'com'\n\n    @allure.story(\"Smoke test\")\n    @allure.feature('Регистрация личного кабинета')\n    @allure.description('Тест регистрации личного кабинета Перевозчика: регистрация - По ссылке Экс, тлф. - '\n                        '98+get_timestamp_eight_signs, инн - Рандом, лицо - Юридическое, почта - Etimestamp@mail.ru, '\n                        'пользователь - Регресс ПВ, после создания заходим в ЛК и проверяем ИНН, '\n                        'далее заходим в ЛК Экс и принимаем ПВ в контур Экс.,')\n    @pytest.mark.parametrize('base_fixture', ['via_link'], indirect=True)\n    def test_registration_new_lkp(base_fixture, domain):\n        # Инициализация базовых объектов через фикстуру\n        base, login = base_fixture\n    \n        reg = Registration(base.driver)\n        # Переход к регистрации нового аккаунта\n        reg.click_button(reg.registration_new_account)\n        # Выбор типа регистрации - Перевозчик\n        reg.click_button(reg.producer_button)\n        phone = \"98\" + reg.get_timestamp(eight=True)\n        # Ввод номера телефона\n        reg.input_in_field(reg.phone_input, phone, click_first=True)\n        # Принятие политики конфиденциальности\n        reg.click_button(reg.privacy_policy_checkbox)\n        # Запрос кода подтверждения\n        reg.click_button(reg.get_code_button)\n    \n        sms = SmsCenter(base.driver)\n        # Открытие нового окна для получения кода подтверждения\n        sms.driver.execute_script(\"window.open(arguments[0]);\", sms.sms_url)\n        WebDriverWait(base.driver, 60).until(lambda d: len(d.window_handles) > 1)\n        windows = base.driver.window_handles\n        base.driver.switch_to.window(windows[1])\n    \n        # Ввод логина и пароля для доступа к СМС центру\n        sms.input_in_field(sms.sms_login_input, sms_center[\"login\"], safe=True)\n        sms.input_in_field(sms.sms_password_input, sms_center[\"password\"], safe=True)\n        # Переход к деталям сообщений\n        sms.click_button(sms.sms_login_button)\n        sms.click_button(sms.detailing_button)\n    \n        # Получение кода подтверждения\n>       code = sms.get_confirmation_code(phone)\n\ntests\\test_registration.py:216: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <pages.sms_center_page.SmsCenter object at 0x000001AC732211F0>, phone_number = '9809185617', max_attempts = 12\n\n    def get_confirmation_code(self, phone_number, max_attempts=12):\n        \"\"\"\n        Извлекает код подтверждения, связанный с заданным номером телефона, с повторными попытками.\n    \n        Parameters\n        ----------\n        phone_number : str\n            Номер телефона в формате 10 цифр без префикса.\n        max_attempts : int, optional\n            Максимальное количество попыток проверки.\n    \n        Returns\n        -------\n        str or None\n            Код подтверждения как строку, если найден, или None, если не найден после всех попыток.\n    \n        Raises\n        ------\n        ValueError\n            Если код подтверждения не найден после всех попыток.\n        \"\"\"\n        formatted_phone = '+7' + phone_number\n        xpath_locator = f\"//tr[contains(.//div, '{formatted_phone}')]//div[contains(text(), 'Код подтверждения:')]\"\n    \n        for attempt in range(max_attempts):\n            try:\n                element_text = WebDriverWait(self.driver, 5).until(\n                    EC.visibility_of_element_located((By.XPATH, xpath_locator))\n                ).text\n                match = re.search(r'\\d+', element_text)\n                if match:\n                    print(f\"Код подтверждения получен на попытке {attempt + 1}: {match.group(0)}\")\n                    return match.group(0)\n            except TimeoutException:\n                print(f\"Попытка {attempt + 1} не удалась. Обновляем страницу...\")\n                self.click_button(self.refresh_button)\n    \n        # Если после всех попыток код не найден, выбрасываем ошибку\n>       raise ValueError(f\"Код подтверждения для номера {formatted_phone} не найден после {max_attempts} попыток.\")\nE       ValueError: Код подтверждения для номера +79809185617 не найден после 12 попыток.\n\npages\\sms_center_page.py:76: ValueError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1741540328287,"stop":1741540328288,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"domain","time":{"start":1741546571375,"stop":1741546571375,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"base_fixture","time":{"start":1741546571375,"stop":1741546577259,"duration":5884},"status":"passed","steps":[{"name":"Start test","time":{"start":1741546572513,"stop":1741546572513,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Current url: https://enter.vezubr.com/contour-join?contourCode=DgzHgntfhz","time":{"start":1741546577222,"stop":1741546577222,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false}],"attachments":[],"parameters":[],"hasContent":true,"attachmentStep":false,"stepsCount":2,"attachmentsCount":0,"shouldDisplayMessage":false}],"testStage":{"description":"Тест регистрации личного кабинета Перевозчика: регистрация - По ссылке Экс, тлф. - 98+get_timestamp_eight_signs, инн - Рандом, лицо - Юридическое, почта - Etimestamp@mail.ru, пользователь - Регресс ПВ, после создания заходим в ЛК и проверяем ИНН, далее заходим в ЛК Экс и принимаем ПВ в контур Экс.,","status":"broken","statusMessage":"ValueError: Код подтверждения для номера +79809185617 не найден после 12 попыток.","statusTrace":"base_fixture = (<base.base_class.Base object at 0x000001AC73222060>, <pages.login_page.Login object at 0x000001AC73222420>), domain = 'com'\n\n    @allure.story(\"Smoke test\")\n    @allure.feature('Регистрация личного кабинета')\n    @allure.description('Тест регистрации личного кабинета Перевозчика: регистрация - По ссылке Экс, тлф. - '\n                        '98+get_timestamp_eight_signs, инн - Рандом, лицо - Юридическое, почта - Etimestamp@mail.ru, '\n                        'пользователь - Регресс ПВ, после создания заходим в ЛК и проверяем ИНН, '\n                        'далее заходим в ЛК Экс и принимаем ПВ в контур Экс.,')\n    @pytest.mark.parametrize('base_fixture', ['via_link'], indirect=True)\n    def test_registration_new_lkp(base_fixture, domain):\n        # Инициализация базовых объектов через фикстуру\n        base, login = base_fixture\n    \n        reg = Registration(base.driver)\n        # Переход к регистрации нового аккаунта\n        reg.click_button(reg.registration_new_account)\n        # Выбор типа регистрации - Перевозчик\n        reg.click_button(reg.producer_button)\n        phone = \"98\" + reg.get_timestamp(eight=True)\n        # Ввод номера телефона\n        reg.input_in_field(reg.phone_input, phone, click_first=True)\n        # Принятие политики конфиденциальности\n        reg.click_button(reg.privacy_policy_checkbox)\n        # Запрос кода подтверждения\n        reg.click_button(reg.get_code_button)\n    \n        sms = SmsCenter(base.driver)\n        # Открытие нового окна для получения кода подтверждения\n        sms.driver.execute_script(\"window.open(arguments[0]);\", sms.sms_url)\n        WebDriverWait(base.driver, 60).until(lambda d: len(d.window_handles) > 1)\n        windows = base.driver.window_handles\n        base.driver.switch_to.window(windows[1])\n    \n        # Ввод логина и пароля для доступа к СМС центру\n        sms.input_in_field(sms.sms_login_input, sms_center[\"login\"], safe=True)\n        sms.input_in_field(sms.sms_password_input, sms_center[\"password\"], safe=True)\n        # Переход к деталям сообщений\n        sms.click_button(sms.sms_login_button)\n        sms.click_button(sms.detailing_button)\n    \n        # Получение кода подтверждения\n>       code = sms.get_confirmation_code(phone)\n\ntests\\test_registration.py:216: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <pages.sms_center_page.SmsCenter object at 0x000001AC732211F0>, phone_number = '9809185617', max_attempts = 12\n\n    def get_confirmation_code(self, phone_number, max_attempts=12):\n        \"\"\"\n        Извлекает код подтверждения, связанный с заданным номером телефона, с повторными попытками.\n    \n        Parameters\n        ----------\n        phone_number : str\n            Номер телефона в формате 10 цифр без префикса.\n        max_attempts : int, optional\n            Максимальное количество попыток проверки.\n    \n        Returns\n        -------\n        str or None\n            Код подтверждения как строку, если найден, или None, если не найден после всех попыток.\n    \n        Raises\n        ------\n        ValueError\n            Если код подтверждения не найден после всех попыток.\n        \"\"\"\n        formatted_phone = '+7' + phone_number\n        xpath_locator = f\"//tr[contains(.//div, '{formatted_phone}')]//div[contains(text(), 'Код подтверждения:')]\"\n    \n        for attempt in range(max_attempts):\n            try:\n                element_text = WebDriverWait(self.driver, 5).until(\n                    EC.visibility_of_element_located((By.XPATH, xpath_locator))\n                ).text\n                match = re.search(r'\\d+', element_text)\n                if match:\n                    print(f\"Код подтверждения получен на попытке {attempt + 1}: {match.group(0)}\")\n                    return match.group(0)\n            except TimeoutException:\n                print(f\"Попытка {attempt + 1} не удалась. Обновляем страницу...\")\n                self.click_button(self.refresh_button)\n    \n        # Если после всех попыток код не найден, выбрасываем ошибку\n>       raise ValueError(f\"Код подтверждения для номера {formatted_phone} не найден после {max_attempts} попыток.\")\nE       ValueError: Код подтверждения для номера +79809185617 не найден после 12 попыток.\n\npages\\sms_center_page.py:76: ValueError","steps":[{"name":"Click on registration_new_account","time":{"start":1741546577261,"stop":1741546577425,"duration":164},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on producer_button","time":{"start":1741546577425,"stop":1741546577600,"duration":175},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click and Input in phone_input: 9809185617","time":{"start":1741546577600,"stop":1741546577885,"duration":285},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on privacy_policy_checkbox","time":{"start":1741546577885,"stop":1741546577999,"duration":114},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on get_code_button","time":{"start":1741546577999,"stop":1741546578099,"duration":100},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Input in sms_login_input: ***","time":{"start":1741546578162,"stop":1741546583546,"duration":5384},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Input in sms_password_input: ***","time":{"start":1741546583547,"stop":1741546583670,"duration":123},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on sms_login_button","time":{"start":1741546583670,"stop":1741546583811,"duration":141},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on detailing_button","time":{"start":1741546583811,"stop":1741546585559,"duration":1748},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546590747,"stop":1741546590893,"duration":146},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546595994,"stop":1741546596105,"duration":111},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546601201,"stop":1741546601326,"duration":125},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546606426,"stop":1741546606548,"duration":122},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546611660,"stop":1741546611784,"duration":124},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546616877,"stop":1741546616984,"duration":107},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546622093,"stop":1741546622212,"duration":119},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546627333,"stop":1741546627468,"duration":135},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546632583,"stop":1741546632697,"duration":114},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546637827,"stop":1741546637973,"duration":146},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546643069,"stop":1741546643178,"duration":109},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546648288,"stop":1741546648398,"duration":110},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Screen taken: tests_test_registration.py_test_registration_new_lkp[via_link]_2025.03.09.18.57.28.png","time":{"start":1741546648596,"stop":1741546648599,"duration":3},"status":"passed","steps":[],"attachments":[{"uid":"e7161b884250902","name":"Screenshot","source":"e7161b884250902.png","type":"image/png","size":127577}],"parameters":[],"hasContent":true,"attachmentStep":false,"stepsCount":0,"attachmentsCount":1,"shouldDisplayMessage":false}],"attachments":[],"parameters":[],"hasContent":true,"attachmentStep":false,"stepsCount":22,"attachmentsCount":1,"shouldDisplayMessage":true},"afterStages":[{"name":"base_fixture::0","time":{"start":1741546648599,"stop":1741546650819,"duration":2220},"status":"passed","steps":[{"name":"Test finish","time":{"start":1741546648599,"stop":1741546650819,"duration":2220},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false}],"attachments":[],"parameters":[],"hasContent":true,"attachmentStep":false,"stepsCount":1,"attachmentsCount":0,"shouldDisplayMessage":false}],"labels":[{"name":"story","value":"Smoke test"},{"name":"feature","value":"Регистрация личного кабинета"},{"name":"parentSuite","value":"tests"},{"name":"suite","value":"test_registration"},{"name":"host","value":"FirexPC"},{"name":"thread","value":"22332-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_registration"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"base_fixture","value":"'via_link'"}],"links":[],"hidden":true,"retry":true,"extra":{"categories":[],"tags":[]},"source":"3d3d74720893b4fa.json","parameterValues":["'via_link'"]}