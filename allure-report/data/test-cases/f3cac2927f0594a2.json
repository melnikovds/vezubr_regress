{"uid":"f3cac2927f0594a2","name":"test_registration_new_lke[without_login]","fullName":"tests.test_registration#test_registration_new_lke","historyId":"11c637995dd051265f0d31949c6ae73e","time":{"start":1741546421553,"stop":1741546491765,"duration":70212},"description":"Тест регистрации личного кабинета Экспедитора: регистрация - Прямая, тлф. - 98+get_timestamp_eight_signs, инн - Рандом, лицо - Юридическое, почта - Etimestamp@mail.ru, пользователь - Регресс Экс, после создания заходим в ЛК и проверяем ИНН","descriptionHtml":"<p>Тест регистрации личного кабинета Экспедитора: регистрация - Прямая, тлф. - 98+get_timestamp_eight_signs, инн - Рандом, лицо - Юридическое, почта - Etimestamp@mail.ru, пользователь - Регресс Экс, после создания заходим в ЛК и проверяем ИНН</p>\n","status":"broken","statusMessage":"ValueError: Код подтверждения для номера +79809185341 не найден после 12 попыток.","statusTrace":"base_fixture = (<base.base_class.Base object at 0x000001AC73236270>, <pages.login_page.Login object at 0x000001AC73222000>), domain = 'com'\n\n    @allure.story(\"Smoke test\")\n    @allure.feature('Регистрация личного кабинета')\n    @allure.description('Тест регистрации личного кабинета Экспедитора: регистрация - Прямая, тлф. - '\n                        '98+get_timestamp_eight_signs, инн - Рандом, лицо - Юридическое, почта - Etimestamp@mail.ru, '\n                        'пользователь - Регресс Экс, после создания заходим в ЛК и проверяем ИНН')\n    @pytest.mark.parametrize('base_fixture', ['without_login'], indirect=True)\n    def test_registration_new_lke(base_fixture, domain):\n        # Инициализация базовых объектов через фикстуру\n        base, login = base_fixture\n    \n        # Переход к странице регистрации\n        login.click_button(login.registration_button)\n    \n        reg = Registration(base.driver)\n        # Выбор типа регистрации - Экспедитор\n        reg.click_button(reg.expeditor_button)\n        phone = \"98\" + reg.get_timestamp(eight=True)\n        # Ввод номера телефона\n        reg.input_in_field(reg.phone_input, phone, click_first=True)\n        # Принятие политики конфиденциальности\n        reg.click_button(reg.privacy_policy_checkbox)\n        # Запрос кода подтверждения\n        reg.click_button(reg.get_code_button)\n    \n        sms = SmsCenter(base.driver)\n        # Открытие нового окна для получения кода подтверждения\n        sms.driver.execute_script(\"window.open(arguments[0]);\", sms.sms_url)\n        WebDriverWait(base.driver, 60).until(lambda d: len(d.window_handles) > 1)\n        windows = base.driver.window_handles\n        base.driver.switch_to.window(windows[1])\n    \n        # Ввод логина и пароля для доступа к СМС центру\n        sms.input_in_field(sms.sms_login_input, sms_center[\"login\"], safe=True)\n        sms.input_in_field(sms.sms_password_input, sms_center[\"password\"], safe=True)\n        # Переход к деталям сообщений\n        sms.click_button(sms.sms_login_button)\n        sms.click_button(sms.detailing_button)\n    \n        # Получение кода подтверждения\n>       code = sms.get_confirmation_code(phone)\n\ntests\\test_registration.py:51: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <pages.sms_center_page.SmsCenter object at 0x000001AC73221EE0>, phone_number = '9809185341', max_attempts = 12\n\n    def get_confirmation_code(self, phone_number, max_attempts=12):\n        \"\"\"\n        Извлекает код подтверждения, связанный с заданным номером телефона, с повторными попытками.\n    \n        Parameters\n        ----------\n        phone_number : str\n            Номер телефона в формате 10 цифр без префикса.\n        max_attempts : int, optional\n            Максимальное количество попыток проверки.\n    \n        Returns\n        -------\n        str or None\n            Код подтверждения как строку, если найден, или None, если не найден после всех попыток.\n    \n        Raises\n        ------\n        ValueError\n            Если код подтверждения не найден после всех попыток.\n        \"\"\"\n        formatted_phone = '+7' + phone_number\n        xpath_locator = f\"//tr[contains(.//div, '{formatted_phone}')]//div[contains(text(), 'Код подтверждения:')]\"\n    \n        for attempt in range(max_attempts):\n            try:\n                element_text = WebDriverWait(self.driver, 5).until(\n                    EC.visibility_of_element_located((By.XPATH, xpath_locator))\n                ).text\n                match = re.search(r'\\d+', element_text)\n                if match:\n                    print(f\"Код подтверждения получен на попытке {attempt + 1}: {match.group(0)}\")\n                    return match.group(0)\n            except TimeoutException:\n                print(f\"Попытка {attempt + 1} не удалась. Обновляем страницу...\")\n                self.click_button(self.refresh_button)\n    \n        # Если после всех попыток код не найден, выбрасываем ошибку\n>       raise ValueError(f\"Код подтверждения для номера {formatted_phone} не найден после {max_attempts} попыток.\")\nE       ValueError: Код подтверждения для номера +79809185341 не найден после 12 попыток.\n\npages\\sms_center_page.py:76: ValueError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1741540328287,"stop":1741540328288,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"base_fixture","time":{"start":1741546414896,"stop":1741546421553,"duration":6657},"status":"passed","steps":[{"name":"Start test","time":{"start":1741546416010,"stop":1741546416011,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Current url: https://enter.vezubr.com/login","time":{"start":1741546421514,"stop":1741546421514,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false}],"attachments":[],"parameters":[],"hasContent":true,"attachmentStep":false,"stepsCount":2,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"domain","time":{"start":1741546414896,"stop":1741546414896,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false}],"testStage":{"description":"Тест регистрации личного кабинета Экспедитора: регистрация - Прямая, тлф. - 98+get_timestamp_eight_signs, инн - Рандом, лицо - Юридическое, почта - Etimestamp@mail.ru, пользователь - Регресс Экс, после создания заходим в ЛК и проверяем ИНН","status":"broken","statusMessage":"ValueError: Код подтверждения для номера +79809185341 не найден после 12 попыток.","statusTrace":"base_fixture = (<base.base_class.Base object at 0x000001AC73236270>, <pages.login_page.Login object at 0x000001AC73222000>), domain = 'com'\n\n    @allure.story(\"Smoke test\")\n    @allure.feature('Регистрация личного кабинета')\n    @allure.description('Тест регистрации личного кабинета Экспедитора: регистрация - Прямая, тлф. - '\n                        '98+get_timestamp_eight_signs, инн - Рандом, лицо - Юридическое, почта - Etimestamp@mail.ru, '\n                        'пользователь - Регресс Экс, после создания заходим в ЛК и проверяем ИНН')\n    @pytest.mark.parametrize('base_fixture', ['without_login'], indirect=True)\n    def test_registration_new_lke(base_fixture, domain):\n        # Инициализация базовых объектов через фикстуру\n        base, login = base_fixture\n    \n        # Переход к странице регистрации\n        login.click_button(login.registration_button)\n    \n        reg = Registration(base.driver)\n        # Выбор типа регистрации - Экспедитор\n        reg.click_button(reg.expeditor_button)\n        phone = \"98\" + reg.get_timestamp(eight=True)\n        # Ввод номера телефона\n        reg.input_in_field(reg.phone_input, phone, click_first=True)\n        # Принятие политики конфиденциальности\n        reg.click_button(reg.privacy_policy_checkbox)\n        # Запрос кода подтверждения\n        reg.click_button(reg.get_code_button)\n    \n        sms = SmsCenter(base.driver)\n        # Открытие нового окна для получения кода подтверждения\n        sms.driver.execute_script(\"window.open(arguments[0]);\", sms.sms_url)\n        WebDriverWait(base.driver, 60).until(lambda d: len(d.window_handles) > 1)\n        windows = base.driver.window_handles\n        base.driver.switch_to.window(windows[1])\n    \n        # Ввод логина и пароля для доступа к СМС центру\n        sms.input_in_field(sms.sms_login_input, sms_center[\"login\"], safe=True)\n        sms.input_in_field(sms.sms_password_input, sms_center[\"password\"], safe=True)\n        # Переход к деталям сообщений\n        sms.click_button(sms.sms_login_button)\n        sms.click_button(sms.detailing_button)\n    \n        # Получение кода подтверждения\n>       code = sms.get_confirmation_code(phone)\n\ntests\\test_registration.py:51: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <pages.sms_center_page.SmsCenter object at 0x000001AC73221EE0>, phone_number = '9809185341', max_attempts = 12\n\n    def get_confirmation_code(self, phone_number, max_attempts=12):\n        \"\"\"\n        Извлекает код подтверждения, связанный с заданным номером телефона, с повторными попытками.\n    \n        Parameters\n        ----------\n        phone_number : str\n            Номер телефона в формате 10 цифр без префикса.\n        max_attempts : int, optional\n            Максимальное количество попыток проверки.\n    \n        Returns\n        -------\n        str or None\n            Код подтверждения как строку, если найден, или None, если не найден после всех попыток.\n    \n        Raises\n        ------\n        ValueError\n            Если код подтверждения не найден после всех попыток.\n        \"\"\"\n        formatted_phone = '+7' + phone_number\n        xpath_locator = f\"//tr[contains(.//div, '{formatted_phone}')]//div[contains(text(), 'Код подтверждения:')]\"\n    \n        for attempt in range(max_attempts):\n            try:\n                element_text = WebDriverWait(self.driver, 5).until(\n                    EC.visibility_of_element_located((By.XPATH, xpath_locator))\n                ).text\n                match = re.search(r'\\d+', element_text)\n                if match:\n                    print(f\"Код подтверждения получен на попытке {attempt + 1}: {match.group(0)}\")\n                    return match.group(0)\n            except TimeoutException:\n                print(f\"Попытка {attempt + 1} не удалась. Обновляем страницу...\")\n                self.click_button(self.refresh_button)\n    \n        # Если после всех попыток код не найден, выбрасываем ошибку\n>       raise ValueError(f\"Код подтверждения для номера {formatted_phone} не найден после {max_attempts} попыток.\")\nE       ValueError: Код подтверждения для номера +79809185341 не найден после 12 попыток.\n\npages\\sms_center_page.py:76: ValueError","steps":[{"name":"Click on registration_button","time":{"start":1741546421553,"stop":1741546421697,"duration":144},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on expeditor_button","time":{"start":1741546421697,"stop":1741546421795,"duration":98},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click and Input in phone_input: 9809185341","time":{"start":1741546421795,"stop":1741546422031,"duration":236},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on privacy_policy_checkbox","time":{"start":1741546422032,"stop":1741546422135,"duration":103},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on get_code_button","time":{"start":1741546422135,"stop":1741546422232,"duration":97},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Input in sms_login_input: ***","time":{"start":1741546422307,"stop":1741546427135,"duration":4828},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Input in sms_password_input: ***","time":{"start":1741546427135,"stop":1741546427278,"duration":143},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on sms_login_button","time":{"start":1741546427278,"stop":1741546427412,"duration":134},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on detailing_button","time":{"start":1741546427412,"stop":1741546428921,"duration":1509},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546434027,"stop":1741546434170,"duration":143},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546439265,"stop":1741546439384,"duration":119},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546444503,"stop":1741546444639,"duration":136},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546449798,"stop":1741546449912,"duration":114},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546455031,"stop":1741546455167,"duration":136},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546460268,"stop":1741546460386,"duration":118},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546465486,"stop":1741546465599,"duration":113},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546470707,"stop":1741546470816,"duration":109},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546475927,"stop":1741546476046,"duration":119},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546481170,"stop":1741546481290,"duration":120},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546486406,"stop":1741546486545,"duration":139},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Click on refresh_button","time":{"start":1741546491652,"stop":1741546491765,"duration":113},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false},{"name":"Screen taken: tests_test_registration.py_test_registration_new_lke[without_login]_2025.03.09.18.54.51.png","time":{"start":1741546491974,"stop":1741546491976,"duration":2},"status":"passed","steps":[],"attachments":[{"uid":"7874495b863d581","name":"Screenshot","source":"7874495b863d581.png","type":"image/png","size":127593}],"parameters":[],"hasContent":true,"attachmentStep":false,"stepsCount":0,"attachmentsCount":1,"shouldDisplayMessage":false}],"attachments":[],"parameters":[],"hasContent":true,"attachmentStep":false,"stepsCount":22,"attachmentsCount":1,"shouldDisplayMessage":true},"afterStages":[{"name":"base_fixture::0","time":{"start":1741546491976,"stop":1741546494210,"duration":2234},"status":"passed","steps":[{"name":"Test finish","time":{"start":1741546491976,"stop":1741546494210,"duration":2234},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false}],"attachments":[],"parameters":[],"hasContent":true,"attachmentStep":false,"stepsCount":1,"attachmentsCount":0,"shouldDisplayMessage":false}],"labels":[{"name":"story","value":"Smoke test"},{"name":"feature","value":"Регистрация личного кабинета"},{"name":"parentSuite","value":"tests"},{"name":"suite","value":"test_registration"},{"name":"host","value":"FirexPC"},{"name":"thread","value":"22332-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_registration"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"base_fixture","value":"'without_login'"}],"links":[],"hidden":true,"retry":true,"extra":{"categories":[],"tags":[]},"source":"f3cac2927f0594a2.json","parameterValues":["'without_login'"]}